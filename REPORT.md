# Final Report

Name: Jikke van den Ende  
Student number: 10787593

## Description
The visualisations from this project illustrate different number in worldwide plastics production, plastic waste generation and plastic pollution of the oceans. It shows how the plastic production has risen over the last few years, to what extent countries all over the world contribute to the global plastic waste generation and how much of their waste is maneged/mismanaged. A visualisation only about the USA shows how much (for example) recycling rates have risen over the last few years, but also that the number of plastic particles floating in the oceans basins is still outrageous.  

The screenshot below shows a map of the world. While hovering over a country (China in this case) it will show the user the plastic waste generation by the whole country for 2010, and below in the piechart it illustrates how many percent of the global plastic waste is generated by that country. The second layer of the piechart displays the proportion rates between managed and mismaneged waste generation for the selected country.

![alt text](/doc/reportScreenshot.png)  

## Technical Design  

The index html leads the user to the homepage of this project. There are two options to navigate to: the visualisations page and the sources page. The visualisations page has it's own visualisations html (the most important one) and the sources page has it's own sources html. The index and sources html only contain text and don't use any functions or d3. The visualisations html does, and  relies on multiple JavaScript files.  

There consist five different visualisations on this webpage. The first visualisation is a single-linegraph which stands on his own. It has it's own JavaScript file, linechart.js. Next there is a barchart which also stands on his own. It has his own JavaScript file as well, recycling.js. The datamap with the dropdownmenu and the piechart with the second layer share a JavaScript file, project.js. The last barchart has it's own JavaScript file again, oceanchart.js.  

Now I will explain every JavaScript file more deeply.  

main.js:  
This is the main script that loads when the visualisations webpage is loaded. It relies on all the other four JavaScript files.  
First it uses the `timelineChart()` function from the linechart.js for creating the function that will draw a line + axes for some data. It then creates a function called `resize()` that makes sure that the size of the chart is dependent from the window size. Then, it loads in the data for the linechart and calls the line function to actually create the graph.  
It then uses the `makeBarchart()` function from the recycling.js to create the first barchart.  
After that, it uses the `Promise.all()` function for loading in the four different .json files and then `combineData()` (from project.js) to create one complete datafile for the section with the datamap and piechart. After this it calls the function `createMap()` and `donutChart()` for creating these two visualisations (from project.js).  
At last, it uses the function `oceanChart()` fromt oceanchart.js to actually create the last barchart.

linechart.js:  
This file is used to create the single-line chart that shows the world wide plastics production from 1950 until 2015. It contains one main function `timelineChart() ` which returns the function that is gonna create a timeline-line to the main.js file. It consists of three different functions. For the transition of the line I used two different functions, `transition()` and `tweenDash()`. By interpolating the stroke-dasharray style property (to the function `tweenDash()`), it's possible to animate a stroke from start to end. The function `chart()` actually sets all the values given a selection for the axis, the line and the movement from beginning to end. It also sets the possibility for hovering over the path of the linegraph with the function `mousemove()`. A circle appears on the point of the year the user hovers over and it shows information on the right sight of the linechart. All the function on the bottom of the file are important for the resize function in the main.js file.

recycling.js:  
This file is used for creating the first barchart that shows the plastics generation for the USA from 1960 until 2015, and how much of this generation gets recycled, landfilled or combusted into Energy Recovery. It's main function is `makeBarChart()` which (obviously) creates the barchart when it's called in the main.js file. It uses two extra self-made functions for finding the minimum and maximum value in a stack (`stackMin()` and `stackMax()`). This `makeBarchart()` function is easily understandable, it's just stacking the data, setting the values/functions for the axis and the rectangles, creating a mousedown event (showing information about the part of the bar the user clicked on) and creating a legend.

project.js:
This file is a bit chaotic.  
The `combineData()` function that the main.js file calls to combine the four datafiles together if the first function here. It takes the first datafile as the 'main' and adds the datapoints from the other files from the same countries together in this first datafile. Per country all the data about plastic waste is available in one dataset.  
The `createMap()` function draws a map of the world with the `countryMap()` function when it's being called in the main.js file. Further it adds a title, a undertitle, a dropdownmenu and the legend. The `countryMap()` function uses Datamaps by Github. First it add different fillkeys for the two different datasets (waste per country in total and waste per capita,  which can be selected in the dropdownmenu). Then it creates the datamap just for the data of waste per country. The choropleth I used is from W3Schools. Hoovering will give you a tooltip showing the amount of plastic waste for that country. How darker the color of the country, how higher this amount is. It returns the map to the `createMap()` section. The function `onchange()` contains the code for what happens when another selection is chosen in the dropdownmenu. It stores the selected value, and based on that updates the choropleth from the worldmap. It uses another fillkey when the selection is 'waste per capita'. It also changes the undertitle (what information is shown in the datamap) and removes the old legend and creates a new one.  
The `roundtoTwo()` function is used in several parts of the code in this file to (surprisingly) round a number to two integers behind the period.  
The `prepareDataDonutInside()` prepares the data into a usable format for the donutchart/piechart. It being used in several pieces of code in this project.js file, especially for making it easier to get information into the tooltips.  
The `donutChart()` function creates the inner donutchart/piechart when it's being called in the main.js file. It illustrates the share (percentage) of every country to the total global plastic waste generation. It first prepares the data with `prepareDataDonutInside()` (see above) and then draws the path for the piechart with help from `pie()` and `arc()`. The function `toolTipDonut()` is called at last, for creating the tooltip insided the piechart (the innerradius isn't zero, so it becomes more of a donut than a pie). This functions takes a selection (the pieslice a user hoovers over) and shows the name of the country and the percentage that pieslice represents.  
The `prepareDataDonutOutside()` function prepares the data into a usable format for the outer circle of the piechart.  
The `secondLayerDonutChart()` is very similar as the `donutChart()` function, only the radius and the used data is different. And a transition is being added to this layer, using the `arcTween()` function.  It also makes use of the `toolTipDonut()` function for creating the tooltip again, this time only showing the name of the country.  
The `toolTipTEXT()` function return the string what is being printed inside of the tooltip created in the `toolTipDonut()` function. It checks the key in the used data, and depending on that returns what's needed in the tooltip.  
The `arcTween()` function is used for the transition of the second layer of the piechart. With help from `interpolate()` the function returns the new d for the attrTween attribute of the `transition()`.

oceanchart.js:  
This file is very similar to the recycling.js file. It's main function is `oceanChart()` which is calles in the main.js file to create the last barchart about the number of plastic particles floating in the six different ocean basins of the world. It sets the values/functions for the svg, the x- and y-scale and the rectangles. When hoovering over a bar a tooltip will apear which shows the exact datapoint.



## Challenges during the process  
The resize function I used for the linechart is based on a project of Mike Bostock. I tried using it for other charts, to have a smooth resizing for them as well, but that seemed really harder than I thought. In the end I thought it wasn't the most important thing to focus on, but for a more smooth resize of the window (and so the visualisations) it would have been nicer if I accomplished that for the other visualisations as well.

## Defend of decisions
