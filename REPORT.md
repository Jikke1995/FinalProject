# Final Report

Name: Jikke van den Ende  
Student number: 10787593

## Description
The visualisations from this project illustrate different number in worldwide plastics production, plastic waste generation and plastic pollution of the oceans. It shows how the plastic production has risen over the last few years, to what extent countries all over the world contribute to the global plastic waste generation and how much of their waste is maneged/mismanaged. A visualisation only about the USA shows how much (for example) recycling rates have risen over the last few years, but also that the number of plastic particles floating in the oceans basins is still outrageous.  

The screenshot below shows a map of the world. While hovering over a country (China in this case) it will show the user the plastic waste generation by the whole country for 2010, and below in the piechart it illustrates how many percent of the global plastic waste is generated by that country. The second layer of the piechart displays the proportion rates between managed and mismaneged waste generation for the selected country.

![alt text](/doc/reportScreenshot.png)  

## Technical Design  

The index html leads the user to the homepage of this project. There are two options to navigate to: the visualisations page and the sources page. The visualisations page has it's own visualisations html (the most important one) and the sources page has it's own sources html. The index and sources html only contain text and don't use any functions or d3. The visualisations html does, and  relies on multiple JavaScript files.  

There consist five different visualisations on this webpage. The first visualisation is a single-linegraph which stands on his own. It has it's own JavaScript file, linechart.js. Next there is a barchart which also stands on his own. It has his own JavaScript file as well, recycling.js. The datamap with the dropdownmenu and the piechart with the second layer share a JavaScript file, project.js. The last barchart has it's own JavaScript file again, oceanchart.js.  

Now I will explain every JavaScript file more deeply.  

main.js:  
This is the main script that loads when the visualisations webpage is loaded. It relies on all the other four JavaScript files.  
First it uses the `timelineChart()` function from the linechart.js for creating the function that will draw a line + axes for some data. It then creates a function called `resize()` that makes sure that the size of the chart is dependent from the window size. Then, it loads in the data for the linechart and calls the line function to actually create the graph.  
It then uses the `makeBarchart()` function from the recycling.js to create the first barchart.  
After that, it uses the `Promise.all()` function for loading in the four different .json files and then `combineData()` (from project.js) to create one complete datafile for the section with the datamap and piechart. After this it calls the function `createMap()` and `donutChart()` for creating these two visualisations (from project.js).  
At last, it uses the function `oceanChart()` fromt oceanchart.js to actually create the last barchart.

linechart.js:  
This file is used to create the single-line chart that shows the world wide plastics production from 1950 until 2015. It contains one main function `timelineChart() ` which returns the function that is gonna create a timeline-line to the main.js file. It consists of three different functions. For the transition of the line I used two different functions, `transition()` and `tweenDash()`. By interpolating the stroke-dasharray style property (to the function `tweenDash()`), it's possible to animate a stroke from start to end. The function `chart()` actually sets all the values given a selection for the axis, the line and the movement from beginning to end. It also sets the possibility for hovering over the path of the linegraph with the function `mousemove()`. A circle appears on the point of the year the user hovers over and it shows information on the right sight of the linechart. All the function on the bottom of the file are important for the resize function in the main.js file.

recycling.js:  
This file is used for creating the first barchart that shows the plastics generation for the USA from 1960 until 2015, and how much of this generation gets recycled, landfilled or combusted into Energy Recovery. It's main function is `makeBarChart()` which (obviously) creates the barchart when it's called in the main.js file. It uses two extra self-made functions for finding the minimum and maximum value in a stack (`stackMin()` and `stackMax()`). This `makeBarchart()` function is easily understandable, it's just stacking the data, setting the values/functions for the axis and the rectangles, creating a mousedown event (showing information about the part of the bar the user clicked on) and creating a legend.

project.js:
This file is a bit chaotic.  
The `combineData()` function that the main.js file calls to combine the four datafiles together if the first function here. It takes the first datafile as the 'main' and adds the datapoints from the other files from the same countries together in this first datafile. Per country all the data about plastic waste is available in one dataset.  
The `createMap()` function draws a map of the world with the `countryMap()` function when it's being called in the main.js file. Further it adds a title, a undertitle, a dropdownmenu and the legend. The `countryMap()` function uses Datamaps by Github. First it add different fillkeys for the two different datasets (waste per country in total and waste per capita,  which can be selected in the dropdownmenu). Then it creates the datamap just for the data of waste per country. The choropleth I used is from W3Schools. Hoovering will give you a tooltip showing the amount of plastic waste for that country. How darker the color of the country, how higher this amount is. It returns the map to the `createMap()` section. The function `onchange()` contains the code for what happens when another selection is chosen in the dropdownmenu. It stores the selected value, and based on that updates the choropleth from the worldmap. It uses another fillkey when the selection is 'waste per capita'. It also changes the undertitle (what information is shown in the datamap) and removes the old legend and creates a new one.  
The `roundtoTwo()` function is used in several parts of the code in this file to (surprisingly) round a number to two integers behind the period.  
The `prepareDataDonutInside()` prepares the data into a usable format for the donutchart/piechart. It being used in several pieces of code in this project.js file, especially for making it easier to get information into the tooltips.  
The `donutChart()` function creates the inner donutchart/piechart when it's being called in the main.js file. It illustrates the share (percentage) of every country to the total global plastic waste generation. It first prepares the data with `prepareDataDonutInside()` (see above) and then draws the path for the piechart with help from `pie()` and `arc()`. The function `toolTipDonut()` is called at last, for creating the tooltip insided the piechart (the innerradius isn't zero, so it becomes more of a donut than a pie). This functions takes a selection (the pieslice a user hoovers over) and shows the name of the country and the percentage that pieslice represents.  
The `prepareDataDonutOutside()` function prepares the data into a usable format for the outer circle of the piechart.  
The `secondLayerDonutChart()` is very similar as the `donutChart()` function, only the radius and the used data is different. And a transition is being added to this layer, using the `arcTween()` function.  It also makes use of the `toolTipDonut()` function for creating the tooltip again, this time only showing the name of the country.  
The `toolTipTEXT()` function return the string what is being printed inside of the tooltip created in the `toolTipDonut()` function. It checks the key in the used data, and depending on that returns what's needed in the tooltip.  
The `arcTween()` function is used for the transition of the second layer of the piechart. With help from `interpolate()` the function returns the new d for the attrTween attribute of the `transition()`.

oceanchart.js:  
This file is very similar to the recycling.js file. It's main function is `oceanChart()` which is calles in the main.js file to create the last barchart about the number of plastic particles floating in the six different ocean basins of the world. It sets the values/functions for the svg, the x- and y-scale and the rectangles. When hoovering over a bar a tooltip will apear which shows the exact datapoint.

## Challenges during the process  
When I take a look at my [DESIGN.md](DESIGN.md), there are only a few small differences with the end-result. The biggest is that is that I skipped the piechart that would appear when clicking on one of the bars in the ocean-barchart. It would illustrate the different kind of particles floating in that ocean, and how the proportion rates are. I realised that for what I wanted to do with my visualisations it wouldn't add very interesting information for the user to see which kind of particles were floating around. So instead I made a second barchart for showing the information about the USA. The proportion rates between landfilling, recycling and combusting of plastic waste were more interesting to look at I think. The other difference is that the dropdown menu belonging to the worldmap gives you the options for showing the 'waste per country' or 'waste per capita of country'. The mismanaged/manages waste rates I first wanted to show as well, but now I displayed them in the second layer of the piechart.

Eventhough this second layer of the piechart is a nicer visualisation, because it shows clearly the ratio between the managed/mismanaged waste of a country, I had a hard time doing the transition for this part of the piechart. It took me a while before I understood all the functions that were needed for creating the piechart, and what I was changing in the `transition()` function. I never made a piechart before, I think that's why this part took me more time. And it was also challenging to relate this second layer to the datamap. You can click on a country in the map, and the second layer displays as well. But the data has to be in the same format, otherwise you can't use the function again. This took me some time, and I think that if I didn't do so much processing with the data afterwards (as with the function `prepareDataDonutInside()` and `prepareDataDonutOutside()`) it would have been easier. I think I made it too complex for myself, and should have used the same dataformat the whole time instead of putting it in different formats/temporary datasets. You loose this information in other functions, and that makes it much harder to find the data back again.  

The single-line chart was eventually also a challenging I think, because it was hard to find a way to do the timeline transition smoothly. In advance I had thought that this would be easier, but that wasn't the case. I needed much help in creating this visualisation, but as I look back: this part of code is the most nice clean and clear of all, so it took some effort, but I'm very happy with the the results.  

The resize function I used for the linechart is based on a project of Mike Bostock. I tried using it for other charts, to have a smooth resizing for them as well, but that seemed harder than I thought. In the end I thought it wasn't the most important thing to focus on, but for a more smooth resize of the window (and so the visualisations) it would have been nicer if I accomplished that for the other visualisations as well. Now you have to reload the windowpage to get all the visualisations into a correct and readable format.

## Defend of decisions
It isn't bad that I changed some things to the design of my project. The changes are small, and I only changed them because the information they would illustrate seemed to be less important for the users of this webpage then what I now illustrate. The second layer of the piechart was a nice addition to the visualisation, because of the transition I could implement, and for the interactivity of the visualisation. The second barchart with information about the plaste waste generation of the USA is a good addition as well, for showing the user that the generation of plastic was grows rapidly over the years, but the rates in recycling and combusting grow slowly. That is exactly the problem I want to show.From the start, I actually wanted to show the 'plastic gyres' in the ocean in a map of worldwide oceans. It was too advanced for now, but I still think this is the best visualisation you can have to inform people on where those gyres exist, and how big they are. In an ideal world, given more time, I would change that. I also would keep the base code for every visualisation but would use the data differently. I would create one tooltip function (a global one) and use that in every visualisation, so I don't have to duplicate code. 
